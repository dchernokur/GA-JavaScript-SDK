/*!
 * ga-javascript-sdk - version 2.0.4 
 * Unofficial JavaScript SDK for GameAnalytics, REST API v2 version
 *
 * Gembly BV
 * Build at 17-12-2015
 * Released under GNUv3 License 
 */

var CryptoJS=CryptoJS||function(a,b){var c={},d=c.lib={},e=function(){},f=d.Base={extend:function(a){e.prototype=this;var b=new e;return a&&b.mixIn(a),b.hasOwnProperty("init")||(b.init=function(){b.$super.init.apply(this,arguments)}),b.init.prototype=b,b.$super=this,b},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){},mixIn:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},g=d.WordArray=f.extend({init:function(a,c){a=this.words=a||[],this.sigBytes=c!=b?c:4*a.length},toString:function(a){return(a||i).stringify(this)},concat:function(a){var b=this.words,c=a.words,d=this.sigBytes;if(a=a.sigBytes,this.clamp(),d%4)for(var e=0;a>e;e++)b[d+e>>>2]|=(c[e>>>2]>>>24-8*(e%4)&255)<<24-8*((d+e)%4);else if(65535<c.length)for(e=0;a>e;e+=4)b[d+e>>>2]=c[e>>>2];else b.push.apply(b,c);return this.sigBytes+=a,this},clamp:function(){var b=this.words,c=this.sigBytes;b[c>>>2]&=4294967295<<32-8*(c%4),b.length=a.ceil(c/4)},clone:function(){var a=f.clone.call(this);return a.words=this.words.slice(0),a},random:function(b){for(var c=[],d=0;b>d;d+=4)c.push(4294967296*a.random()|0);return new g.init(c,b)}}),h=c.enc={},i=h.Hex={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;a>d;d++){var e=b[d>>>2]>>>24-8*(d%4)&255;c.push((e>>>4).toString(16)),c.push((15&e).toString(16))}return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;b>d;d+=2)c[d>>>3]|=parseInt(a.substr(d,2),16)<<24-4*(d%8);return new g.init(c,b/2)}},j=h.Latin1={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;a>d;d++)c.push(String.fromCharCode(b[d>>>2]>>>24-8*(d%4)&255));return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;b>d;d++)c[d>>>2]|=(255&a.charCodeAt(d))<<24-8*(d%4);return new g.init(c,b)}},k=h.Utf8={stringify:function(a){try{return decodeURIComponent(escape(j.stringify(a)))}catch(b){throw Error("Malformed UTF-8 data")}},parse:function(a){return j.parse(unescape(encodeURIComponent(a)))}},l=d.BufferedBlockAlgorithm=f.extend({reset:function(){this._data=new g.init,this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=k.parse(a)),this._data.concat(a),this._nDataBytes+=a.sigBytes},_process:function(b){var c=this._data,d=c.words,e=c.sigBytes,f=this.blockSize,h=e/(4*f),h=b?a.ceil(h):a.max((0|h)-this._minBufferSize,0);if(b=h*f,e=a.min(4*b,e),b){for(var i=0;b>i;i+=f)this._doProcessBlock(d,i);i=d.splice(0,b),c.sigBytes-=e}return new g.init(i,e)},clone:function(){var a=f.clone.call(this);return a._data=this._data.clone(),a},_minBufferSize:0});d.Hasher=l.extend({cfg:f.extend(),init:function(a){this.cfg=this.cfg.extend(a),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(a){return this._append(a),this._process(),this},finalize:function(a){return a&&this._append(a),this._doFinalize()},blockSize:16,_createHelper:function(a){return function(b,c){return new a.init(c).finalize(b)}},_createHmacHelper:function(a){return function(b,c){return new m.HMAC.init(a,c).finalize(b)}}});var m=c.algo={};return c}(Math);!function(a){for(var b=CryptoJS,c=b.lib,d=c.WordArray,e=c.Hasher,c=b.algo,f=[],g=[],h=function(a){return 4294967296*(a-(0|a))|0},i=2,j=0;64>j;){var k;a:{k=i;for(var l=a.sqrt(k),m=2;l>=m;m++)if(!(k%m)){k=!1;break a}k=!0}k&&(8>j&&(f[j]=h(a.pow(i,.5))),g[j]=h(a.pow(i,1/3)),j++),i++}var n=[],c=c.SHA256=e.extend({_doReset:function(){this._hash=new d.init(f.slice(0))},_doProcessBlock:function(a,b){for(var c=this._hash.words,d=c[0],e=c[1],f=c[2],h=c[3],i=c[4],j=c[5],k=c[6],l=c[7],m=0;64>m;m++){if(16>m)n[m]=0|a[b+m];else{var o=n[m-15],p=n[m-2];n[m]=((o<<25|o>>>7)^(o<<14|o>>>18)^o>>>3)+n[m-7]+((p<<15|p>>>17)^(p<<13|p>>>19)^p>>>10)+n[m-16]}o=l+((i<<26|i>>>6)^(i<<21|i>>>11)^(i<<7|i>>>25))+(i&j^~i&k)+g[m]+n[m],p=((d<<30|d>>>2)^(d<<19|d>>>13)^(d<<10|d>>>22))+(d&e^d&f^e&f),l=k,k=j,j=i,i=h+o|0,h=f,f=e,e=d,d=o+p|0}c[0]=c[0]+d|0,c[1]=c[1]+e|0,c[2]=c[2]+f|0,c[3]=c[3]+h|0,c[4]=c[4]+i|0,c[5]=c[5]+j|0,c[6]=c[6]+k|0,c[7]=c[7]+l|0},_doFinalize:function(){var b=this._data,c=b.words,d=8*this._nDataBytes,e=8*b.sigBytes;return c[e>>>5]|=128<<24-e%32,c[(e+64>>>9<<4)+14]=a.floor(d/4294967296),c[(e+64>>>9<<4)+15]=d,b.sigBytes=4*c.length,this._process(),this._hash},clone:function(){var a=e.clone.call(this);return a._hash=this._hash.clone(),a}});b.SHA256=e._createHelper(c),b.HmacSHA256=e._createHmacHelper(c)}(Math),function(){var a=CryptoJS,b=a.enc.Utf8;a.algo.HMAC=a.lib.Base.extend({init:function(a,c){a=this._hasher=new a.init,"string"==typeof c&&(c=b.parse(c));var d=a.blockSize,e=4*d;c.sigBytes>e&&(c=a.finalize(c)),c.clamp();for(var f=this._oKey=c.clone(),g=this._iKey=c.clone(),h=f.words,i=g.words,j=0;d>j;j++)h[j]^=1549556828,i[j]^=909522486;f.sigBytes=g.sigBytes=e,this.reset()},reset:function(){var a=this._hasher;a.reset(),a.update(this._iKey)},update:function(a){return this._hasher.update(a),this},finalize:function(a){var b=this._hasher;return a=b.finalize(a),b.reset(),b.finalize(this._oKey.clone().concat(a))}})}(),function(){var a=CryptoJS,b=a.lib.WordArray;a.enc.Base64={stringify:function(a){var b=a.words,c=a.sigBytes,d=this._map;a.clamp(),a=[];for(var e=0;c>e;e+=3)for(var f=(b[e>>>2]>>>24-8*(e%4)&255)<<16|(b[e+1>>>2]>>>24-8*((e+1)%4)&255)<<8|b[e+2>>>2]>>>24-8*((e+2)%4)&255,g=0;4>g&&c>e+.75*g;g++)a.push(d.charAt(f>>>6*(3-g)&63));if(b=d.charAt(64))for(;a.length%4;)a.push(b);return a.join("")},parse:function(a){var c=a.length,d=this._map,e=d.charAt(64);e&&(e=a.indexOf(e),-1!=e&&(c=e));for(var e=[],f=0,g=0;c>g;g++)if(g%4){var h=d.indexOf(a.charAt(g-1))<<2*(g%4),i=d.indexOf(a.charAt(g))>>>6-2*(g%4);e[f>>>2]|=(h|i)<<24-8*(f%4),f++}return b.create(e,f)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}();var GA;!function(a){!function(a){a[a.ios=0]="ios",a[a.android=1]="android",a[a.windows=2]="windows",a[a.windows_phone=3]="windows_phone",a[a.blackberry=4]="blackberry",a[a.roku=5]="roku",a[a.tizen=6]="tizen",a[a.nacl=7]="nacl",a[a.mac_osx=8]="mac_osx",a[a.webplayer=9]="webplayer"}(a.Platform||(a.Platform={})),a.Platform,!function(a){a[a.male=0]="male",a[a.female=1]="female"}(a.Gender||(a.Gender={})),a.Gender}(GA||(GA={}));var GA;!function(a){var b;!function(a){var b=/^[A-Za-z0-9\\s\\-_\\.\\(\\)\\!\\?]{1,64}:[A-Za-z0-9\\s\\-_\\.\\(\\)\\!\\?]{1,64}$/,c=function(){function a(a,c,d,e,f,g){if(this.category=1,this.transaction_num=0,!a||null===a.match(b))throw new Error("Invalid event_id supplied for BusinessEvent");if(this.event_id=a,this.amount=c,!d||null===d.match(/^[A-Z]{3}$/))throw new Error("Invalid currency supplied for BusinessEvent");if(this.currency=d,this.transaction_num=e,f){if(f.length>32)throw new Error("A too long cart_type was supplied, should be max 32 characters");this.cart_type=f}void 0!==g&&(this.receipt_info=g)}return a}();a.Business=c}(b=a.Events||(a.Events={}))}(GA||(GA={}));var GA;!function(a){var b;!function(a){var b=/^[A-Za-z0-9\\s\\-_\\.\\(\\)\\!\\?]{1,64}(:[A-Za-z0-9\\s\\-_\\.\\(\\)\\!\\?]{1,64}){0,4}$/,c=function(){function a(a,c){if(this.category=0,null===a.match(b))throw new Error("Invalid event_id supplied for DesignEvent");this.event_id=a,void 0!==c&&(this.value=c)}return a}();a.Design=c}(b=a.Events||(a.Events={}))}(GA||(GA={}));var GA;!function(a){var b;!function(a){!function(a){a[a.design=0]="design",a[a.business=1]="business",a[a.error=2]="error",a[a.user=3]="user",a[a.session_end=4]="session_end",a[a.progression=5]="progression",a[a.resource=6]="resource"}(a.Category||(a.Category={})),a.Category}(b=a.Events||(a.Events={}))}(GA||(GA={}));var GA;!function(a){var b;!function(a){!function(a){a[a.debug=0]="debug",a[a.info=1]="info",a[a.warning=2]="warning",a[a.error=3]="error",a[a.critical=4]="critical"}(a.ErrorSeverity||(a.ErrorSeverity={}));var b=a.ErrorSeverity,c=function(){function a(a,c){this.category=2,this.message="",this.severity=b[a],void 0!==c&&(this.message=c.substr(0,8192))}return a}();a.Exception=c}(b=a.Events||(a.Events={}))}(GA||(GA={}));var GA;!function(a){var b;!function(a){var b=function(){function a(){}return a}();a.InitResponse=b;var c=function(){function a(a){this.data=a}return a.prototype.toString=function(){return JSON.stringify(this.data)},a}();a.Init=c}(b=a.Events||(a.Events={}))}(GA||(GA={}));var GA;!function(a){var b;!function(a){var b=/^(Start|Fail|Complete):[A-Za-z0-9\\s\\-_\\.\\(\\)\\!\\?]{1,64}(:[A-Za-z0-9\\s\\-_\\.\\(\\)\\!\\?]{1,64}){0,2}$/,c=function(){function a(a,c,d){if(this.category=5,null===a.match(b))throw new Error("Invalid event_id supplied for ProgressionEvent");this.event_id=a,void 0!==c&&(this.attempt_num=c),void 0!==d&&(this.score=d)}return a}();a.Progression=c}(b=a.Events||(a.Events={}))}(GA||(GA={}));var GA;!function(a){var b;!function(a){var b=/^(Sink|Source):[A-Za-z]{1,64}:[A-Za-z0-9\\s\\-_\\.\\(\\)\\!\\?]{1,64}:[A-Za-z0-9\\s\\-_\\.\\(\\)\\!\\?]{1,64}/,c=function(){function a(a,c){if(this.category=6,null===a.match(b))throw new Error("Invalid event_id supplied for ResourceEvent");this.event_id=a,this.amount=c}return a}();a.Resource=c}(b=a.Events||(a.Events={}))}(GA||(GA={}));var GA;!function(a){var b;!function(a){var b=function(){function a(a){this.category=4,this.length=0,this.length=a}return a}();a.SessionEnd=b}(b=a.Events||(a.Events={}))}(GA||(GA={}));var GA;!function(a){var b;!function(a){var b=function(){function a(){this.category=3}return a}();a.User=b}(b=a.Events||(a.Events={}))}(GA||(GA={}));var GA;!function(a){function b(){return null===c.instance&&(c.instance=new c),c.instance}a.getInstance=b;var c=function(){function b(){this.sessionId=a.Utils.createUniqueId(),this.messageQueue=new a.Utils.MessageQueue,this.dataSentCallback=null,this.enabled=!1,this.initProcessed=!1,this.timeoutId=0,this.timeOffset=0}return b.prototype.init=function(c,d,e,f){var g=this;if(null===b.instance)throw new Error("No instance available!");this.gameKey=c,this.secretKey=d,this.build=e,this.user=f;var h=new a.Events.Init(a.Utils.getBaseAnnotations());return this.sendEvent(h.toString(),"init",function(a){g.initProcessed=!0,a.enabled===!0&&(g.enabled=!0,g.timeOffset=(Date.now()/1e3|0)-a.server_ts)}),this.scheduleSendData(b.SCHEDULE_TIME),window.addEventListener("beforeunload",function(){g.sendData()}),this},b.prototype.addEvent=function(c){if(null===b.instance)throw new Error("No instance available!");var d=new a.Utils.Message(c,a.Utils.getDefaultAnnotations(this.user,this.sessionId,this.build,this.timeOffset));return this.messageQueue.push(d),this},b.prototype.setDataSentCallback=function(a){this.dataSentCallback=a},b.prototype.sendData=function(){var a=this;if(this.initProcessed===!1)return this.scheduleSendData(1e3),this;if(this.enabled===!1)return this;if(null===b.instance)throw new Error("No instance available!");for(var c=[],d="";this.messageQueue.length>0;){var e=this.messageQueue.pop();c.push(e.data)}if(0===c.length)return this.scheduleSendData(b.SCHEDULE_TIME),this;try{d=JSON.stringify(c)}catch(f){}return this.sendEvent(d,"events",function(){null!==a.dataSentCallback&&a.dataSentCallback()}),this.scheduleSendData(b.SCHEDULE_TIME),this},b.prototype.scheduleSendData=function(a){var b=this;clearTimeout(this.timeoutId),this.timeoutId=setTimeout(function(){b.sendData()},a)},b.prototype.sendEvent=function(c,d,e){if(void 0===e&&(e=null),null===b.instance&&null===this.gameKey)throw new Error("No instance available!");if(!(c.length<1)){var f=CryptoJS.HmacSHA256(c,this.secretKey),g=CryptoJS.enc.Base64.stringify(f),h=b.API_URL+this.gameKey+"/"+d;a.Utils.postRequest(h,c,g,function(a){if(a.success===!1&&window.console&&console.log(a.message),null!=e){var b="";try{b=JSON.parse(a.message)}catch(c){}e(b)}})}},b.SCHEDULE_TIME=15e3,b.SDK_VERSION="rest api v2",b.API_URL=("https:"===document.location.protocol?"https":"http")+"://api.gameanalytics.com/v2/",b.instance=null,b}();a.GameAnalytics=c}(GA||(GA={}));var GA;!function(a){var b=function(){function a(a,b,c,d){this.user_id="",a&&(this.user_id=a),b&&b.length>0&&(this.facebook_id=b,this.user_id=b),(1===c||0===c)&&(this.gender=c),d&&d.toString().match(/^[0-9]{4}$/gi)&&(this.birth_year=d)}return a}();a.User=b}(GA||(GA={}));var GA;!function(a){var b;!function(b){function c(b,c,d,e){var f={sdk_version:a.GameAnalytics.SDK_VERSION,platform:a.Platform[2],os_version:a.Platform[2]+" 8",device:"unknown",v:2,user_id:b.user_id,client_ts:(Date.now()/1e3|0)+e,manufacturer:"unknown",session_id:c,session_num:1,build:d};b.facebook_id&&(f.facebook_id=b.facebook_id),(0===b.gender||1===b.gender)&&(f.gender=a.Gender[b.gender]),b.birth_year&&(f.birth_year=b.birth_year);var g=navigator.userAgent;return g.match(/iPad|iPod|iPhone/i)?(f.platform=a.Platform[0],f.device=g.match(/iPad|iPod|iPhone/i)[0],f.manufacturer="Apple",f.os_version=a.Platform[0]+" "+g.match(/OS (\b[0-9]+_[0-9]+(?:_[0-9]+)?\b)/)[1].replace(/_/gi,".")):g.match(/Android/i)?(f.platform=a.Platform[1],f.device=g.match(/Mobile/i)?"Phone":"Tablet",f.os_version=a.Platform[1]+" "+g.match(/Android (\d+(?:\.\d+)+);/)[1]):g.match(/Windows Phone/i)&&(f.platform=a.Platform[2],f.device="Windows Phone",f.os_version=a.Platform[2]+" "+g.match(/Phone (\d+(?:\.\d+)+);/)[1]),f}function d(){var b={sdk_version:a.GameAnalytics.SDK_VERSION,platform:"unknown",os_version:"unknown"},c=navigator.userAgent;return c.match(/iPad|iPod|iPhone/i)?(b.platform=a.Platform[0],b.os_version=a.Platform[0]+" "+c.match(/OS (\b[0-9]+_[0-9]+(?:_[0-9]+)?\b)/)[1].replace(/_/gi,".")):c.match(/Android/i)?(b.platform=a.Platform[1],b.os_version=a.Platform[1]+" "+c.match(/Android (\d+(?:\.\d+)+);/)[1]):c.match(/Windows Phone/i)&&(b.platform=a.Platform[2],b.os_version=a.Platform[2]+" "+c.match(/Phone (\d+(?:\.\d+)+);/)[1]),b}b.getDefaultAnnotations=c,b.getBaseAnnotations=d}(b=a.Utils||(a.Utils={}))}(GA||(GA={}));var GA;!function(a){var b;!function(b){var c=function(){function b(a,b){this.event=a,this.annotations=b}return Object.defineProperty(b.prototype,"data",{get:function(){for(var b in this.event)this.event.hasOwnProperty(b)&&("category"===b?this.annotations[b]=a.Events.Category[this.event[b]]:this.annotations[b]=this.event[b]);return this.annotations},enumerable:!0,configurable:!0}),b}();b.Message=c}(b=a.Utils||(a.Utils={}))}(GA||(GA={}));var GA;!function(a){var b;!function(a){var b=function(){function a(){this.queue=[],this.load()}return a.prototype.push=function(a){this.queue.push(a)},a.prototype.pop=function(){return this.queue.pop()},Object.defineProperty(a.prototype,"length",{get:function(){return this.queue.length},enumerable:!0,configurable:!0}),a.prototype.save=function(){},a.prototype.load=function(){},a}();a.MessageQueue=b}(b=a.Utils||(a.Utils={}))}(GA||(GA={}));var GA;!function(a){var b;!function(a){function b(a,b,c,d){var e;if(!window.XMLHttpRequest)return void d({success:!1,message:"Error: Unable to send request, XMLHttpRequest not supported"});e=new XMLHttpRequest,e.onreadystatechange=function(){4==e.readyState&&(200===e.status?d({success:!0,message:e.responseText}):e.status>0&&d({success:!1,message:"Error: There was a problem with the request: status "+e.status}))};try{e.open("POST",a,!0),e.setRequestHeader("Authorization",c),e.setRequestHeader("Content-Type","application/json"),e.send(b)}catch(f){d({success:!1,message:"Error: Unable to send request, CORS not allowed."})}}var c=function(){function a(){this.success=!1,this.message=""}return a}();a.Response=c,a.postRequest=b}(b=a.Utils||(a.Utils={}))}(GA||(GA={}));var GA;!function(a){var b;!function(a){function b(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})}a.createUniqueId=b}(b=a.Utils||(a.Utils={}))}(GA||(GA={})),"undefined"!=typeof module&&(module.exports=GA);